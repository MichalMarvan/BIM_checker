<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IFC Multi-File Viewer</title>
    <link rel="icon" type="image/svg+xml" href="../favicon.svg">
    <link rel="stylesheet" href="../assets/css/common.css">
    <link rel="stylesheet" href="../assets/css/ifc-viewer.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="../index.html" class="back-home-btn">‚Üê Dom≈Ø</a>
            <h1>üìä IFC Multi-File Viewer</h1>
            <p>Naƒçtƒõte v√≠ce IFC soubor≈Ø a zobrazte je v jedn√© spoleƒçn√© tabulce</p>
        </div>

        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìÅ</div>
                <div class="upload-text">Kliknƒõte nebo p≈ôet√°hnƒõte jeden nebo v√≠ce IFC soubor≈Ø</div>
                <input type="file" id="fileInput" accept=".ifc" multiple>
            </div>
            <button class="btn btn-primary" id="loadFromStorageBtn" style="margin: 15px 0; width: 100%; font-size: 1.1em;">
                üì¶ Naƒç√≠st z √∫lo≈æi≈°tƒõ
            </button>
            <div class="file-list" id="fileList"></div>
        </div>

        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <div>Naƒç√≠t√°m IFC soubory...</div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>
            <div class="loading-status" id="loadingStatus"></div>
        </div>

        <div class="edit-panel" id="editPanel">
            <h3>üéØ Hromadn√© operace</h3>
            <p>Vybr√°no: <span class="selected-count" id="selectedCount">0</span> entit <span id="totalFilteredCount" style="color: #6c757d; font-weight: normal;"></span></p>
            <div class="edit-panel-buttons">
                <button class="btn btn-warning" id="bulkEditBtn" disabled>‚úèÔ∏è Hromadn√° √∫prava PSetu</button>
                <button class="btn btn-success" id="addPsetBtn" disabled>‚ûï P≈ôidat PropertySet</button>
                <button class="btn btn-primary" id="exportIfcBtn" disabled>üíæ Ulo≈æit upraven√Ω IFC</button>
                <button class="btn btn-secondary" id="selectAllVisibleBtn">‚òëÔ∏è Vybrat v≈°e na str√°nce</button>
                <button class="btn btn-success" id="selectAllPagesBtn">‚òëÔ∏è‚òëÔ∏è Vybrat v≈°e na V≈†ECH str√°nk√°ch</button>
                <button class="btn btn-secondary" id="deselectAllBtn">‚òê Zru≈°it v√Ωbƒõr</button>
            </div>
        </div>

        <div class="controls" id="controls">
            <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: center;">
                <input type="text" id="searchInput" placeholder="üîç Hledat... (text, /regex/, nebo Sloupec /regex/)" style="flex: 1; min-width: 250px; padding: 12px 20px; border: 2px solid #e9ecef; border-radius: 8px;">
                <select id="entityFilter" style="padding: 10px 15px; border: 2px solid #e9ecef; border-radius: 8px;">
                    <option value="">V≈°echny entity</option>
                </select>
                <select id="fileFilter" style="padding: 10px 15px; border: 2px solid #e9ecef; border-radius: 8px;">
                    <option value="">V≈°echny soubory</option>
                </select>
                <select id="pageSizeSelectTop" style="padding: 10px 15px; border: 2px solid #e9ecef; border-radius: 8px; font-weight: 600;">
                    <option value="100">100 ≈ô√°dk≈Ø</option>
                    <option value="250">250 ≈ô√°dk≈Ø</option>
                    <option value="500" selected>500 ≈ô√°dk≈Ø</option>
                    <option value="1000">1000 ≈ô√°dk≈Ø</option>
                    <option value="2500">2500 ≈ô√°dk≈Ø</option>
                    <option value="-1">V≈°e (pomal√©!)</option>
                </select>
                <button class="btn btn-success" id="columnManagerBtn">‚öôÔ∏è Spr√°va PropertySet≈Ø</button>
                <button class="btn btn-secondary" id="clearFiltersBtn">Vymazat filtry</button>
                <button class="btn btn-primary" id="toggleEditModeBtn">‚úèÔ∏è Editaƒçn√≠ re≈æim</button>
                <button class="btn btn-primary" id="exportBtn">üì• Export CSV</button>
            </div>

            <div class="column-manager" id="columnManager">
                <h3>üîß P≈ôesu≈àte PropertySety (‚ò∞) nebo jednotliv√© Properties (‚ãÆ)</h3>
                <div id="psetList"></div>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="btn btn-success" id="applyColumnsBtn">‚úì Pou≈æ√≠t zmƒõny</button>
                    <button class="btn btn-secondary" id="selectAllBtn">Vybrat v≈°e</button>
                    <button class="btn btn-secondary" id="deselectAllColumnsBtn">Odebrat v≈°e</button>
                </div>
            </div>
        </div>

        <div class="table-container" id="tableContainer">
            <table class="data-table">
                <thead>
                    <tr class="header-row-pset" id="headerRowPset"></tr>
                    <tr class="header-row-prop" id="headerRowProp"></tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>

        <div class="pagination-container" id="paginationContainer">
            <div class="pagination-info">
                <span id="paginationInfo">Zobrazeno 0 z 0 entit</span>
            </div>
            <div class="pagination-controls">
                <button id="firstPageBtn" title="Prvn√≠ str√°nka">‚èÆÔ∏è</button>
                <button id="prevPageBtn" title="P≈ôedchoz√≠">‚óÄÔ∏è</button>

                <div class="page-input-group">
                    <span>Str√°nka</span>
                    <input type="number" id="pageInput" min="1" value="1">
                    <span>z <span id="totalPages">1</span></span>
                    <button id="goToPageBtn">J√≠t</button>
                </div>

                <button id="nextPageBtn" title="Dal≈°√≠">‚ñ∂Ô∏è</button>
                <button id="lastPageBtn" title="Posledn√≠ str√°nka">‚è≠Ô∏è</button>

                <select id="pageSizeSelect">
                    <option value="100">100 ≈ô√°dk≈Ø</option>
                    <option value="250">250 ≈ô√°dk≈Ø</option>
                    <option value="500" selected>500 ≈ô√°dk≈Ø</option>
                    <option value="1000">1000 ≈ô√°dk≈Ø</option>
                    <option value="2500">2500 ≈ô√°dk≈Ø</option>
                    <option value="-1">V≈°e (pomal√©!)</option>
                </select>
            </div>
        </div>

        <div id="statsSection" style="display: none; padding: 20px 40px; background: #f8f9fa;">
            <h3>üìä Celkov√© statistiky</h3>
            <div id="statsGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;"></div>
        </div>
    </div>

    <!-- Modals -->
    <div id="bulkEditModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2>Hromadn√° √∫prava PropertySetu</h2>
                <button class="modal-close" onclick="closeBulkEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>PropertySet:</label>
                    <select id="bulkPsetName">
                        <option value="">-- Vyberte PropertySet --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Property:</label>
                    <select id="bulkPropName" disabled>
                        <option value="">-- Nejprve vyberte PropertySet --</option>
                    </select>
                </div>
                <div id="currentValuesSection" style="display: none; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 2px solid #e9ecef;">
                    <h4 style="margin: 0 0 10px 0; color: #2d3748; font-size: 1em;">üìã Aktu√°ln√≠ hodnoty:</h4>
                    <div id="currentValuesList" style="max-height: 150px; overflow-y: auto;"></div>
                </div>
                <div class="form-group">
                    <label>Nov√° hodnota:</label>
                    <input type="text" id="bulkValue" placeholder="Zadejte novou hodnotu">
                </div>
                <p style="color: #6c757d; font-size: 0.9em;">
                    Tato hodnota bude nastavena pro v≈°ech <span id="bulkEditCount" style="font-weight: 700;">0</span> vybran√Ωch entit.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeBulkEditModal()">Zru≈°it</button>
                <button class="btn btn-warning" onclick="applyBulkEdit()">Pou≈æ√≠t zmƒõny</button>
            </div>
        </div>
    </div>

    <!-- Storage Picker Modal -->
    <div id="storagePickerModal" class="modal-overlay">
        <div class="modal-container" style="max-width: 700px;">
            <div class="modal-header">
                <h2>üì¶ Naƒç√≠st IFC soubory z √∫lo≈æi≈°tƒõ</h2>
                <button class="modal-close" onclick="closeStoragePickerModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px; color: #6c757d;">
                    Vyberte jeden nebo v√≠ce IFC soubor≈Ø z √∫lo≈æi≈°tƒõ:
                </p>
                <div id="storageFileTree" style="max-height: 400px; overflow-y: auto; border: 2px solid #e9ecef; border-radius: 8px; padding: 15px; background: #f8f9fa;">
                    <!-- Zde bude stromov√° struktura soubor≈Ø -->
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #eef2ff; border-radius: 6px;">
                    <strong>Vybr√°no soubor≈Ø:</strong> <span id="selectedFilesCount">0</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeStoragePickerModal()">Zru≈°it</button>
                <button class="btn btn-primary" onclick="loadSelectedFilesFromStorage()">Naƒç√≠st vybran√© soubory</button>
            </div>
        </div>
    </div>

    <div id="addPsetModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2>P≈ôidat PropertySet</h2>
                <button class="modal-close" onclick="closeAddPsetModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>N√°zev PropertySetu:</label>
                    <input type="text" id="newPsetName" placeholder="nap≈ô. Pset_WallCommon">
                </div>
                <div class="form-group">
                    <label>N√°zev Property:</label>
                    <input type="text" id="newPropName" placeholder="nap≈ô. FireRating">
                </div>
                <div class="form-group">
                    <label>Hodnota:</label>
                    <input type="text" id="newPropValue" placeholder="Zadejte hodnotu">
                </div>
                <p style="color: #6c757d; font-size: 0.9em;">
                    PropertySet a property budou p≈ôid√°ny k <span id="addPsetCount" style="font-weight: 700;">0</span> vybran√Ωm entit√°m.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddPsetModal()">Zru≈°it</button>
                <button class="btn btn-success" onclick="applyAddPset()">P≈ôidat</button>
            </div>
        </div>
    </div>

    <script src="../assets/js/common/storage.js"></script>
    <script src="../assets/js/viewer.js"></script>
</body>
</html>
